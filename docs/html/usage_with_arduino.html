<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>Commander-API: Usage with Arduino</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<!-- Change Github link here! -->
<a href="https://github.com/dani007200964/Commander-API" class="github-corner" title="View source on GitHub">
    <svg viewBox="0 0 250 250" style="position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.PNG"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Commander-API
   &#160;<span id="projectnumber">V2.0.0</span>
   </div>
   <div id="projectbrief">Commander-API  is a C++ API, that parses character based commands.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('usage_with_arduino.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Usage with Arduino </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#basic_example">Basic example</a></li>
<li class="level1"><a href="#the_importance_of_responce_func">The importance of response function</a></li>
<li class="level1"><a href="#print_the_description">Print the description</a></li>
<li class="level1"><a href="#when_to_use_a_buffer">When and how to use a buffer?</a></li>
<li class="level1"><a href="#arduino_printf_function">Arduino printf function</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="basic_example"></a>
Basic example</h1>
<p><b>1.</b></p>
<p>The first thing you have to do is to add the library files to your project. It is discussed in the Arduino installation page how to do.</p>
<p><b>2.</b></p>
<p>The next thing you have to do is to include the library at the beginning of your program.</p>
<p>Code: </p><div class="fragment"><div class="line">#include &quot;interpreter.hpp&quot;</div>
</div><!-- fragment --><p><b>3.</b></p>
<p>Now, you have to create at leas 3 commands, and add them to the interpreter. To do that, first you have to open the interpreter.cpp file. Locate the next comment:</p>
<div class="fragment"><div class="line">//  +----  Create instruction data for the API  ----+</div>
<div class="line">//  |                                               |</div>
<div class="line">//  |       This is where you have to add           |</div>
<div class="line">//  |               your commands!                  |</div>
<div class="line">//  |                                               |</div>
<div class="line">//  +-----------------------------------------------+</div>
</div><!-- fragment --><p>By default in the code, there are 4 commands created as an example, below this comment.</p>
<div class="fragment"><div class="line">create_command_data(stop, &quot;This command can be used to stop something.\r\nargs:\td - generic number\r\n\tc - someting else&quot;);</div>
<div class="line">create_command_data(start, &quot;This command can be used to start something.\r\nargs:\td - generic number\r\n\tc - someting else&quot;);</div>
<div class="line">create_command_data(left, &quot;This command can be used to make someting turn left.\r\nargs:\td - generic number\r\n\tc - someting else&quot;);</div>
<div class="line">create_command_data(right, &quot;This command can be used to make someting turn right.\r\nargs:\td - generic number\r\n\tc - someting else&quot;);</div>
</div><!-- fragment --><p>You can modify these of course. How you can create a new one is shown in the next step.</p>
<p><b>4.</b></p>
<p>If you want to create a new command, firstly you have to create its data. To do that you have to use create_command_data macro. The syntax is:</p>
<div class="fragment"><div class="line">create_command_data( name_of_the_command, description_of_this_command );</div>
</div><!-- fragment --><p>Example: </p><div class="fragment"><div class="line">create_command_data( reset, &quot;description of reset command&quot; );</div>
</div><!-- fragment --><p><b>Note that the name of the command should not have " characters before and after like a regular string!</b> The name also can't start with a number, and you can't use any special characters in it like: ?!,:-...etc..</p>
<p><b>5.</b></p>
<p>In step 3, and 4 you only created the data for the commands. In this step you have to add these data to the interpreter. To do that you have to find the following text int the implementation of init_interpreter function:</p>
<div class="fragment"><div class="line">//  +----  Match instruction to it&#39;s function   ----+</div>
<div class="line">//  |                                               |</div>
<div class="line">//  |       This is where you have to match         |</div>
<div class="line">//  |       every instruction name to it&#39;s          |</div>
<div class="line">//  |                   function.                   |</div>
<div class="line">//  |                                               |</div>
<div class="line">//  +-----------------------------------------------+</div>
</div><!-- fragment --><p>By default in the code, there are 4 commands added as an example, below this comment.</p>
<div class="fragment"><div class="line">add_command(stop, stop_func);</div>
<div class="line">add_command(start, start_func);</div>
<div class="line">add_command(left, left_func);</div>
<div class="line">add_command(right, right_func);</div>
</div><!-- fragment --><p>You can modify these of course. How you can create a new one is shown in the next step.</p>
<p><b>6.</b></p>
<p>To add the created data to the interpreter you have to use add_command macro. The syntax is: </p><div class="fragment"><div class="line">add_command( name_of_the_command, function_for_this_command );</div>
</div><!-- fragment --><p>Example: </p><div class="fragment"><div class="line">add_command( reset, reset_func );</div>
</div><!-- fragment --><p><b>Not that the name of the command has to match exactly with the name in step 3 and 4!</b></p>
<p><b>7.</b></p>
<p>Now you have to create the function that will be executed when the command arrives to the interpreter. The name of this function has to be exactly the same as the function name( 2nd argument ) in step 5, and 6.</p>
<p>Example: </p><div class="fragment"><div class="line">// This is an example function for the reset command</div>
<div class="line">void reset_func(char *args, int(*resp_fn)(const char*, ...))</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">  int test_arg1;</div>
<div class="line">  int test_arg2;</div>
<div class="line">  int arg_read_result;</div>
<div class="line"> </div>
<div class="line">  Serial.println( &quot;Reset function called&quot; );</div>
<div class="line"> </div>
<div class="line">  // Do the actual code somewhere here.</div>
<div class="line"> </div>
<div class="line">  // If you want to use the response channel,</div>
<div class="line">  // This is how to do it correctly.</div>
<div class="line">  // Always check the response function channel!</div>
<div class="line">  // If it&#39;s a NULL pointer you can&#39;t use it,</div>
<div class="line">  // because it will crash your porgram!</div>
<div class="line">  if( resp_fn != NULL ){</div>
<div class="line"> </div>
<div class="line">    resp_fn( &quot;Wow! Magic!!!!\r\n&quot; );</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  // If you have arguments you have to process it like a sscanf</div>
<div class="line">  arg_read_result = sscanf( args, &quot;%d %d&quot;, test_arg1, test_arg2 );</div>
<div class="line"> </div>
<div class="line">  // You should check that if the argument read was successfully</div>
<div class="line">  // sscanf should return exactly the same number as how many arguments</div>
<div class="line">  // you have added.</div>
<div class="line">  if( arg_read_result == 2 ){</div>
<div class="line"> </div>
<div class="line">    // Arguments processed, no error.</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  else{</div>
<div class="line"> </div>
<div class="line">    // Some of the arguments has an error.</div>
<div class="line">    // Maybe a Type-O.</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p>The example above is quite complex, but it shows all of the futures that a command function has. You don't have to use all of it if you doesn't need that specific function. The only restriction is that the function type has to be the same.</p>
<p>You can write these functions driectly in interpreter.cpp file, or you can create a header and an implementation file for your command functions and include that in interpreter.hpp.</p>
<p>Example: </p><div class="fragment"><div class="line">void name_of_the_function(char *args, int(*resp_fn)(const char*, ...));</div>
</div><!-- fragment --><p>I know that it is not pretty, but in practice you just copy and rename it.</p>
<p><b>8.</b></p>
<p>The next thing is to count how many commands you have. <b>This number has to be exact!</b> You have to open interpreter.hpp file, then search for the NUM_OF_API_FUNCS definition. Give this macro the correct number of commands.</p>
<p><b>9.</b></p>
<p>The library has an option called ARDUINO_PLATFORM in interpreter.hpp. If you use Arduino IDE you have to uncomment this define.</p>
<p><b>10.</b></p>
<p>Now the basic configuration of the library is finished, so you just have to use it in your code. The interpreter has to be initialized. To initialise the interpreter the safest practise is, to initialise it as soon as possible. The reason for this is because the library uses some recursive functions to build a binary tree from the commands. It needs a relatively high amount of stack compared a simple initialisation function. After the initialisation this stack memory will be freed up. In Arduino environment basically you have to init Serial first, then, init the interpreter in the beginning of the setup function.</p>
<p>Code: </p><div class="fragment"><div class="line">init_interpreter();</div>
</div><!-- fragment --><p><b>10.</b></p>
<p>Now you just have to use the execute function every time you want to execute a command. The 3 examples in the Arduino folder in the repository shows 3 detailed example to use and understand this library.</p>
<p><b>Congratulations, you have made your first project with <a class="el" href="class_commander.html" title="Commander class.">Commander</a> API :)</b></p>
<h1><a class="anchor" id="the_importance_of_responce_func"></a>
The importance of response function</h1>
<p><img src="response_function_explained_01.png" alt="" class="inline"/>   </p>
<p>Imagine a system that has a various number of channels to communicate with. For example a Linux system, which has its shell redirected to SSH, Serial, GUI... If a command arrives in one of the supported channels, you want to generate the response to that channel. For example if a command arrives from Serial, you want to generate the answer and the messages from the command to Serial as well, not to any other channels. This is why response function is used. The <a class="el" href="class_commander.html" title="Commander class.">Commander</a> API handles everything you just have to create a valid response function to it. The advanced demo shows how to add a response function correctly. If you don't use a response function, please use NULL as argument. In this case the error messages will be redirected to INTERPRETER_PRINTF definition.</p>
<h1><a class="anchor" id="print_the_description"></a>
Print the description</h1>
<p><img src="description_example.png" alt="" class="inline"/>   </p>
<p>To print the description you just have to add a question mark to the end of the command.</p>
<h1><a class="anchor" id="when_to_use_a_buffer"></a>
When and how to use a buffer?</h1>
<p><a class="el" href="class_commander.html" title="Commander class.">Commander</a> API designed to work mainly on embedded devices. In these devices usually you work from RAM. If you work from RAM you have an option to modify the contant of the command that has given to the execute function. There are two cases when you <b>MUST</b> have to use a buffer:</p>
<p><b>1.</b> When you want to use the execute function with constant data. In this case the <a class="el" href="class_commander.html" title="Commander class.">Commander</a> API will try to overwrite this data, while executing the command. Why is it work like this is explained in the source file. In this case it will cause Hard Fault, because the software will try to modify the content of the FLASH( or program ) memory. This is restricted.</p>
<p><b>2.</b> When you don't want to modify the data. In my opinion it is very rare. In most cases you just collect the command string until a terminator character and pass it to the interpreter. If you need the command string after the execute function use a buffer.</p>
<p>How to setup buffered mode:</p>
<p><b>1.</b></p>
<p>Open interpreter.hpp and find INTERPRETER_BUFFER_SIZE definition.</p>
<p><b>2.</b></p>
<p>If it is commented, uncomment it. You have to decide how large buffer you need. If it is too large than you will waste RAM. If it is too short, than you can't interpret large commands correctly.</p>
<p>If you <b>does not need a buffer</b>, than you <b>MUST uncomment</b> INTERPRETER_BUFFER_SIZE!</p>
<h1><a class="anchor" id="arduino_printf_function"></a>
Arduino printf function</h1>
<p>The arduino_printf function is implemented by compatibility reasons. <a class="el" href="class_commander.html" title="Commander class.">Commander</a> API requires a printf like function as a communication channel. This function acts like a printf function, but it is redirected to serial. If you need more channels like TCP or bluetooth you have to implement a printf like functions for those channels as well. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
